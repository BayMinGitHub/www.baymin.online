<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Linuxç³»ç»Ÿä¸‹æ­å»ºé¥¥è’ä¸“ç”¨æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘ä¸»æœºï¼‰</title>
      <link href="/2019/04/24/Linux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%90%AD%E5%BB%BA%E9%A5%A5%E8%8D%92%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
      <url>/2019/04/24/Linux%E7%B3%BB%E7%BB%9F%E4%B8%8B%E6%90%AD%E5%BB%BA%E9%A5%A5%E8%8D%92%E4%B8%93%E7%94%A8%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„é¥¥è’ä¸“ç”¨æœåŠ¡å™¨æ•™ç¨‹~~~</p><a id="more"></a><h4 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h4><p>ç»å¸¸ç©å•æœºæ¸¸æˆçš„ç©å®¶éƒ½ä¼šçŸ¥é“ï¼Œåœ¨è”æœºè¿‡ç¨‹ä¸­æˆ¿ä¸»çš„ç½‘ç»œçŠ¶æ€å’Œç”µè„‘æ€§èƒ½å½±å“ç€æ•´ä¸ªæˆ¿é—´ä¸­ç©å®¶çš„æ¸¸æˆä½“éªŒï¼Œåœ¨æˆ¿ä¸»ç½‘ç»œçŠ¶æ€å·®æˆ–ç”µè„‘æ€§èƒ½ä½çš„æ—¶å€™ï¼Œç»å¸¸ä¼šå‡ºç°å¡é¡¿ï¼Œä¸¢åŒ…ç”šè‡³æ‰çº¿çš„æƒ…å†µã€‚è¿™æ˜¯ç”±äºåœ¨æˆ¿ä¸»å¼€æ¸¸æˆçš„æ—¶å€™ï¼Œä¼šåœ¨å…¶ç”µè„‘æœ¬åœ°å¯åŠ¨ä¸€ä¸ªæœåŠ¡å™¨ç«¯ï¼Œç„¶åç©å®¶çš„æ¸¸æˆå®¢æˆ·ç«¯éƒ½ä¸è¿™ä¸ªæœåŠ¡å™¨ç«¯è¿æ¥ï¼Œè¿›è¡Œè”æœºæ¸¸æˆï¼Œå½“æˆ¿ä¸»ç”µè„‘æ€§èƒ½ä¸è¶³æˆ–è€…ç½‘ç»œæ³¢åŠ¨æ—¶ï¼Œå¿…å®šä¼šå½±å“æ•´ä¸ªæœåŠ¡å™¨ä¸­çš„ç©å®¶ä½“éªŒã€‚</p><h4 id="1-å‡†å¤‡"><a href="#1-å‡†å¤‡" class="headerlink" title="1.å‡†å¤‡"></a>1.å‡†å¤‡</h4><p>â‘  ç”¨æ¥ä¹°äº‘ä¸»æœºçš„ Money â€¦ ( å—¯ â€¦ é’±æ˜¯å¾ˆé‡è¦çš„ .. ä¸è¿‡å¯ä»¥è€ƒè™‘ä¸€ä¸‹å­¦ç”Ÿæœº ,å¦‚æœè¿˜æ˜¯å­¦ç”Ÿçš„è¯ )</p><p>â‘¡ ä¸€å°å¯ä»¥ä¸Šç½‘çš„ç”µè„‘ ( åºŸè¯ ) </p><p>â‘¢ SSHè¿æ¥å·¥å…· ( æ¨èXshell,<a href="https://pan.baidu.com/s/1qe4Kz3Jj2xu-f2ct0YLA-w" target="_blank" rel="noopener">å…è´¹ç‰ˆ</a>å³å¯ï¼Œæå–ç ï¼šidvz  )</p><h4 id="2-è´­ä¹°äº‘ä¸»æœº"><a href="#2-è´­ä¹°äº‘ä¸»æœº" class="headerlink" title="2.è´­ä¹°äº‘ä¸»æœº"></a>2.è´­ä¹°äº‘ä¸»æœº</h4><p>æ­¤å¤„ä½¿ç”¨é˜¿é‡Œäº‘ä¸»æœºä½œä¸ºç¤ºä¾‹ã€‚</p><p>é¦–å…ˆæ‰“å¼€<a href="https://account.aliyun.com/login/login.htm" target="_blank" rel="noopener">é˜¿é‡Œäº‘å®˜ç½‘</a>ï¼Œæ³¨å†Œâ€¦ç™»é™†â€¦å®ååˆ¶ä¹‹ç±»çš„ä¸œè¥¿ï¼Œç„¶åæ‰“å¼€<a href="https://ecs-buy.aliyun.com/wizard" target="_blank" rel="noopener">è´­ä¹°é¡µé¢</a> ï¼š</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦. 1</p><p>åœ°åŸŸï¼šæœåŠ¡å™¨åœ°åŒºå°½é‡é€‰æ‹©ç¦»ä½ è¾ƒè¿‘çš„åœ°åŸŸï¼Œå¯ä»¥æœ‰æ•ˆé™ä½å»¶è¿Ÿã€‚</p><p>å®ä¾‹ï¼šä¸€å®šä¸è¦å› ä¸ºä¾¿å®œè€Œé€‰çªå‘æ€§å®ä¾‹ï¼Œè¿™ä¸ªè§„æ ¼çš„äº‘ä¸»æœºæ¯å¤©åªæœ‰2ä¸ªå¤šå°æ—¶æ˜¯æ»¡æ€§èƒ½çš„ï¼Œå…¶ä»–æƒ…å†µä¸‹éƒ½æ˜¯è¶…çº§å¡çš„çŠ¶æ€ ( æ˜¾ç„¶æˆ‘æ˜¯ä¹°è¿‡çš„â€¦ğŸ˜­ )</p><p>é•œåƒï¼šé€‰æ‹©CentOS 7.6 64ä½ ( å¦‚æœä¼šLinuxç›¸å…³çŸ¥è¯†ï¼Œç³»ç»Ÿå¯è‡ªå·±é€‰æ‹© )</p><p>å­˜å‚¨ï¼šé»˜è®¤40Gï¼Œå®Œå…¨å¤Ÿç”¨äº† </p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œè¿›å…¥ç½‘ç»œå’Œå®‰å…¨ç»„é…ç½®ï¼š</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 2</p><p>ç½‘ç»œï¼šé»˜è®¤</p><p>å…¬ç½‘å¸¦å®½ï¼šé€‰æ‹©æŒ‰å›ºå®šå¸¦å®½1M ( å¤šäººå¯ä»¥è€ƒè™‘2Mï¼Œå¦‚æœç”¨é‡ä¸å¤§å¯ä»¥é€‰æ‹©æŒ‰é‡ä»˜è´¹ï¼Œä¸è¿‡ä¸ç¡®å®šä¸€ä¸ªæœˆçš„å…·ä½“æµé‡ )</p><p>å®‰å…¨ç»„ï¼šé»˜è®¤</p><p>ç‚¹å‡»ä¸‹ä¸€æ­¥ï¼Œè¿›å…¥ç³»ç»Ÿé…ç½®ï¼š</p><p>ç™»å½•å‡­è¯ï¼šé€‰æ‹©è‡ªå®šä¹‰å¯†ç ï¼Œè¾“å…¥ç™»å½•å¯†ç  ( ä»¥åå¯ä»¥åœ¨æ§åˆ¶å°é‡ç½®å¯†ç  )</p><p>å…¶ä»–é»˜è®¤ï¼Œç„¶åç¡®è®¤è®¢å•ï¼Œä»˜æ¬¾ã€‚</p><p>å…³äºæœåŠ¡å™¨é…ç½®çš„é€‰æ‹©ï¼Œè´´ä¸€å¼ å®˜ç½‘çš„å›¾ï¼š</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦. 3</p><p>æ„æ€å°±æ˜¯ï¼š</p><p>â‘  ä¸€ä¸ªç©å®¶éœ€è¦8Kb/sçš„ä¸Šä¼ å¸¦å®½ ( äº‘ä¸»æœºçš„å®½å¸¦é€šå¸¸å°±æ˜¯æŒ‡çš„ä¸Šä¼ å¸¦å®½ï¼Œè¿™ä¸ªå¾ˆå®¹æ˜“æ»¡è¶³ ) </p><p>â‘¡ ä¸€ä¸ªç©å®¶å¤§çº¦éœ€è¦65Må†…å­˜ ( å†…å­˜æ˜¯éœ€è¦é‡è§†çš„é—®é¢˜ï¼Œé€šå¸¸ç©é¥¥è’éƒ½ä¼šå¼€å¯ä¸¤ä¸ªä¸–ç•Œï¼šä¸€ä¸ªåœ°ä¸Šï¼Œä¸€ä¸ªåœ°ä¸‹ã€‚å› æ­¤åœ¨è®¡ç®—å†…å­˜çš„æ—¶å€™ï¼Œå¦‚æœä½ é€‰æ‹©å¼€å¯ä¸¤ä¸ªä¸–ç•Œï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°æ®éœ€è¦ä¹˜ä¸Š2ã€‚è€Œä¸”è¿™ä¸ªæ˜¯æŒ‡ä¸å¼€ä»»ä½•Modçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ˜¯å¤§å‹Modï¼Œå†…å­˜å ç”¨æ˜¯å¾ˆå¯æ€•çš„ã€‚ä¹‹å‰è¯•è¿‡ä¸€æ¬¡æ™ºèƒ½æ•Œå¯¹ï¼Œä¸€ä¸ªä¸–ç•Œçš„è¿›ç¨‹èƒ½åƒ1Gçš„å†…å­˜ )</p><p>â‘¢ ä¸æ˜¯å¾ˆæ¸…æ¥šå®ƒè¯´çš„CPUæ˜¯N/Aæ˜¯ä»»æ„çš„æ„æ€ä¹ˆï¼Œå¯æ˜¯å®é™…ä¸ŠåæœŸä¸–ç•Œä¸­çš„ç”Ÿç‰©è¶Šæ¥è¶Šå¤šçš„æƒ…å†µä¸‹ï¼ŒCPUç‰¹åˆ«å®¹æ˜“çˆ† ( æ¨èå®‰è£…æœåŠ¡å™¨æ¸…ç†Mod )</p><p>â‘£ éœ€è¦çš„ç¯å¢ƒ</p><p>å‚è€ƒ : æˆ‘ä½¿ç”¨çš„æ˜¯1æ ¸2G2Må¸¦å®½çš„æœåŠ¡å™¨ ,ä¸€å¹´è´¹ç”¨æ˜¯1000+ï¼Œåœ¨è£…æœ‰æœåŠ¡å™¨æ¸…ç†Modçš„æƒ…å†µä¸‹ï¼Œæ­£å¸¸6äººç©åˆ°200å¤šå¤©æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œä¸è¿‡åœ¨é’è›™é›¨å’Œèœ˜è››åŒºçš„æ—¶å€™è¿˜æ˜¯ä¼šå¾ˆå¡ã€‚( åæ§½ä¸€ä¸‹ï¼šåƒåœ¾æ¸¸æˆæ¸£ä¼˜åŒ–ï¼Œä»¥å‰å¼„æ±‚ç”Ÿä¹‹è·¯æœåŠ¡å™¨çš„æ—¶å€™ï¼Œå®Œå…¨ä¸éœ€è¦è€ƒè™‘å†…å­˜çš„é—®é¢˜ï¼Œé¥¥è’è¿™ç§è´´å›¾æ¸¸æˆå®åœ¨æ˜¯å¤ªåƒå†…å­˜äº†â€¦ğŸ˜’ )</p><h4 id="3-é…ç½®å¹¶è¿æ¥äº‘ä¸»æœº"><a href="#3-é…ç½®å¹¶è¿æ¥äº‘ä¸»æœº" class="headerlink" title="3.é…ç½®å¹¶è¿æ¥äº‘ä¸»æœº"></a>3.é…ç½®å¹¶è¿æ¥äº‘ä¸»æœº</h4><p>ä»˜æ¬¾åï¼Œè¿‡ä¸€åˆ†é’Ÿå·¦å³å°±å¯ä»¥åœ¨<a href="https://ecs.console.aliyun.com/" target="_blank" rel="noopener">æ§åˆ¶å°</a>çœ‹åˆ°äº‘ä¸»æœºäº†ï¼Œæ˜¾ç¤ºçš„éƒ½æ˜¯ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼Œè®°å½•ä¸‹å…¬ç½‘IPåœ°å€ã€‚ç„¶åæŒ‰ç…§ä¸‹å›¾è¿›å…¥å®‰å…¨ç»„é…ç½®ï¼š</p><p>æ­¤å¤„åº”ç”¨å›¾ç‰‡ã€‚ã€‚ã€‚ 4</p><p>ç‚¹å‡»é…ç½®è§„åˆ™ï¼š( é¥¥è’æœåŠ¡å™¨é»˜è®¤ç«¯å£ä¸º10999å’Œ10998ï¼Œå› æ­¤éœ€è¦å¼€å¯è¿™ä¸¤ä¸ªç«¯å£ )</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 5 </p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 6</p><p>æ‰“å¼€Xshellå·¥å…·ï¼Œä½¿ç”¨å¿«æ·é”®ALT+Næ–°å»ºè¿æ¥ï¼Œå¦‚ä¸‹å›¾ ( ä¹Ÿå¯ä»¥ç‚¹å‡» -&gt; æ–‡ä»¶ -&gt; æ–°å»º )ï¼š</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 7 </p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 8</p><p>ç‚¹å‡»è¿æ¥ï¼Œä¸‹é¢çš„æç¤ºç‚¹å‡»ç¡®å®šï¼Œè¿›å…¥ä¸‹é¢çš„ç•Œé¢å°±è¡¨ç¤ºè¿æ¥æˆåŠŸï¼š</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 9</p><h4 id="4-ä¸‹è½½å¹¶å®‰è£…æ¸¸æˆ"><a href="#4-ä¸‹è½½å¹¶å®‰è£…æ¸¸æˆ" class="headerlink" title="4.ä¸‹è½½å¹¶å®‰è£…æ¸¸æˆ"></a>4.ä¸‹è½½å¹¶å®‰è£…æ¸¸æˆ</h4><p>æ¥ä¸‹æ¥å°±æ˜¯æ“ä½œLinuxç³»ç»Ÿäº†ï¼Œä¸‹é¢å‘½ä»¤æŒ‰è¡Œæ•²å…¥çª—å£ä¸­ï¼ŒæŒ‰å›è½¦é”®æ‰§è¡Œã€‚</p><p>é¦–å…ˆæ›´æ–°yum ( Linuxç³»ç»Ÿä¸­å®‰è£…è½¯ä»¶åŒ…çš„å·¥å…· ) : </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum update</span><br><span class="line">yum upgrade -y</span><br></pre></td></tr></table></figure><p>å®‰è£…æ¸¸æˆè¿è¡Œç¯å¢ƒå’Œå¸¸ç”¨å·¥å…·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install glibc.i686 libstdc++.i686 libcurl.i686 vim screen -y</span><br></pre></td></tr></table></figure><p>åˆ›å»ºsteamç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">useradd steam </span><br><span class="line">su steam</span><br><span class="line">cd ~</span><br><span class="line">mkdir steamcmd</span><br><span class="line">cd steamcmd</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å¹¶è§£å‹Steamçš„Linuxå®¢æˆ·ç«¯steamcmd</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget https://steamcdn-a.akamaihd.net/client/installer/steamcmd_linux.tar.gz</span><br><span class="line">tar -zxvf steamcmd_linux.tar.gz</span><br></pre></td></tr></table></figure><p>å¯åŠ¨Steamå®¢æˆ·ç«¯ï¼Œå¹¶å¼€å§‹ä¸‹è½½é¥¥è’ ( é¥¥è’ä¸“ç”¨æœåŠ¡å™¨IDä¸º 343050 ) </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./steamcmd.sh +login anonymous +force_install_dir /home/dst +app_update 343050 validate +quit</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å®Œæ¯•å ( å¤§æ¦‚ååˆ†é’Ÿå·¦å³ )ï¼Œå…ˆå¯åŠ¨ä¸€æ¬¡æœåŠ¡å™¨ï¼ŒéªŒè¯æ˜¯å¦ç¼ºå¤±ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/steam/dst/bin</span><br><span class="line">~/dst/bin/dontstarve_dedicated_server_nullrenderer -cluster MyDediServer -shard Master</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯èƒ½ä¼šæŠ¥æ‰¾ä¸åˆ°libcurl-gnutls.so.4ï¼Œè§£å†³æ–¹æ³•ä¸ºå°†è¯¥ä¾èµ–åº“å¤åˆ¶åˆ°é¥¥è’æ¸¸æˆæ–‡ä»¶å¤¹ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cpÂ /usr/lib/libcurl.so.4 ~/dst/bin/lib32/libcurl-gnutls.so.4</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯èƒ½ä¼šæœ‰å…¶ä»–ä¾èµ–åŒ…çš„ç¼ºå¤±é—®é¢˜ï¼Œè§£å†³åŠæ³•å³æ˜¯å°†ä¾èµ–å¤åˆ¶åˆ°é¥¥è’æ¸¸æˆæ–‡ä»¶å¤¹ä¸­ã€‚</p><p>æ­£å¸¸å¯åŠ¨åï¼ŒæŒ‰Ctrl+Cå³å¯å…³é—­æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ§åˆ¶å°å‘½ä»¤c_shutdown()ã€‚</p><p>PSï¼šé¥¥è’æœåŠ¡å™¨æ§åˆ¶å°æŒ‡ä»¤è‡ªè¡Œç™¾åº¦ã€‚</p><h4 id="5-å­˜æ¡£é…ç½®"><a href="#5-å­˜æ¡£é…ç½®" class="headerlink" title="5.å­˜æ¡£é…ç½®"></a>5.å­˜æ¡£é…ç½®</h4><p>åœ¨å­˜æ¡£é…ç½®ä¹‹å‰ï¼Œæˆ‘ä»¬ç°åœ¨ç”µè„‘ä¸Šæ‰“å¼€é¥¥è’è”æœºç‰ˆæ¸¸æˆï¼Œè¿›å…¥ä¸»ç•Œé¢ï¼Œç‚¹å‡»ä¸‹é¢çš„å®˜ç½‘æŒ‰é’®ï¼ŒæŸ¥çœ‹ä¸ªäººIDå’Œä¸ªäººæœåŠ¡å™¨çš„tokenï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä¸ªäººID: KU_uG******</span><br><span class="line">æœåŠ¡å™¨token: pds-g^KU_uGVY9tdU^M***************************Sdsg50g4A6jg=</span><br></pre></td></tr></table></figure><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 10 11 12</p><p>é¥¥è’é»˜è®¤å­˜æ¡£ä½ç½®åœ¨ç”¨æˆ·ç›®å½•ä¸­.kielæ–‡ä»¶å¤¹ä¸­ (  ~/.kiel/DoNotStarveTogether)ï¼Œç”±äºæˆ‘ä»¬åœ¨ä¸Šé¢çš„å¯åŠ¨å‘½ä»¤ä¸­å¢åŠ äº†-clusterå‚æ•°ï¼Œå› æ­¤ä¼šåœ¨è¯¥æ–‡ä»¶å¤¹ä¸­è‡ªåŠ¨åˆ›å»ºåä¸ºMyDediServerçš„å­˜æ¡£æ–‡ä»¶å¤¹ï¼Œå¦‚æœä¸æŒ‡å®šè¯¥å‚æ•°ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”ŸæˆCluster_1çš„æ–‡ä»¶å¤¹ã€‚ç”±äºé¥¥è’æœåŠ¡å™¨ç›´æ¥é…ç½®æ–‡ä»¶å¤ªè¿‡å¤æ‚ï¼Œè¿™é‡Œæ¨èä½¿ç”¨å­˜æ¡£æ›¿æ¢çš„æ–¹å¼ã€‚</p><p>é¦–å…ˆåœ¨ä¸ªäººç”µè„‘ä¸Šå¯åŠ¨æ¸¸æˆï¼Œåˆ›å»ºä¸€ä¸ªæ–°ä¸–ç•Œ ( æ­¤å¤„è®°ä½æœåŠ¡å™¨æ ä½1~5 ) ï¼Œè‡ªå®šä¹‰è‡ªå·±çš„ä¸–ç•Œé…ç½®å’ŒModé…ç½®ï¼Œå¯åŠ¨ä¸–ç•Œåç­‰åˆ°é€‰äººç•Œé¢æ—¶é€€å‡º</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 13</p><p>åœ¨æ¸¸æˆé¦–é¡µç‚¹å‡»å­˜æ¡£å›¾æ ‡ï¼Œè¿›å…¥æœ¬åœ°å­˜æ¡£ç›®å½•ï¼ŒæŒ‰ç…§ä½ åˆšæ‰çš„æ ä½æ‰¾åˆ°åä¸ºCluster_[æ ä½]çš„æ–‡ä»¶å¤¹ï¼Œå³ä¸ºåˆšæ‰åˆ›å»ºçš„ä¸–ç•Œå­˜æ¡£ï¼Œå¤åˆ¶å½“å‰æ–‡æ¡£è·¯å¾„ï¼Œä¾‹å¦‚ï¼šF:\æˆ‘çš„æ–‡æ¡£\Klei\DoNotStarveTogether\Cluster_1</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 14</p><p>æ‰“å¼€Xftpå·¥å…·ï¼Œç›´æ¥ç‚¹å‡»ä¸‹å›¾æ‰€ç¤ºå›¾æ ‡å³å¯</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 15</p><p>å·¦è¾¹ä¸ºæœ¬åœ°æ–‡ä»¶ç›®å½•ï¼Œå³è¾¹ä¸ºè¿œç¨‹æœåŠ¡å™¨æ–‡ä»¶ç›®å½•</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 16</p><p>åœ¨å·¦è¾¹ç²˜è´´åˆšæ‰å¤åˆ¶çš„æ–‡æ¡£è·¯å¾„ï¼Œå›è½¦è¿›å…¥ï¼›å³è¾¹è¾“å…¥æœåŠ¡å™¨å­˜æ¡£ç›®å½•å³ /home/steam/.klei/DoNotStarveTogether/MyDediServerï¼Œå›è½¦è¿›å…¥</p><p>æ­¤å¤„åº”æœ‰å›¾ç‰‡â€¦ 17</p><p>æ–‡ä»¶å¯¹åº”è¯´æ˜ï¼š</p><p>â‘  Master æ–‡ä»¶å¤¹ä¸ºä¸»ä¸–ç•Œå³åœ°é¢ä¸–ç•Œå­˜æ¡£åŠé…ç½®</p><p>â‘¡ Caves æ–‡ä»¶å¤¹ä¸ºæ´ç©´ä¸–ç•Œå­˜æ¡£åŠé…ç½®</p><p>â‘¢ cluser.ini æ–‡ä»¶ä¸ºæœåŠ¡å™¨ä¿¡æ¯ï¼Œä¸–ç•Œåç§°ï¼Œå¯†ç ç­‰</p><p>â‘£ cluster_token.txt ä¸ºæœåŠ¡å™¨ token</p><p>â‘¤ Master å’Œ Caves ä¸­å…±æœ‰çš„ : </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">backup -&gt; æœåŠ¡å™¨æ—¥å¿—åŠèŠå¤©æ—¥å¿—å­˜æ¡£</span><br><span class="line">save -&gt;å­˜æ¡£æ–‡ä»¶å¤¹</span><br><span class="line">sever_chat_log.txt -&gt; æœåŠ¡å™¨æ­¤æ¬¡å¯åŠ¨ä¸­ç©å®¶çš„èŠå¤©å†…å®¹</span><br><span class="line">server_log.txt -&gt; æœåŠ¡å™¨æ—¥å¿—</span><br><span class="line">server.ini -&gt; ä¸–ç•Œçš„é…ç½®ä¿¡æ¯ï¼Œç«¯å£ç­‰</span><br><span class="line">leveldataoverride.lua-&gt;ä¸–ç•Œé…ç½®æ–‡ä»¶ï¼Œå³ä¸ºä¸–ç•Œè¯¦ç»†é…ç½®ï¼Œå¯ä»¥ç›´æ¥å¯¹å…¶æ›´æ”¹ï¼Œæ¥å®Œæˆå¯¹ä¸–ç•Œçš„è‡ªå®šä¹‰</span><br><span class="line">modoverrides.lua -&gt; Modé…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å¯¹å…¶ä¿®æ”¹å®ŒæˆæœåŠ¡å™¨Modé…ç½®</span><br></pre></td></tr></table></figure><p>ç›´æ¥é€‰ä¸­å·¦ä¾§æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹ï¼Œæ‹–æ‹½è‡³å³ä¾§ï¼Œé€‰æ‹©å…¨éƒ¨è¦†ç›–ï¼Œç­‰å¾…æ–‡ä»¶å…¨éƒ¨ä¼ è¾“è‡³æœåŠ¡å™¨å³å¯å…³é—­ã€‚ç„¶åå†æ¬¡å›åˆ°Xshellçª—å£ ( ç”±äºåˆ›å»ºsteamç”¨æˆ·æ—¶æ²¡æœ‰å¢åŠ å¯†ç ï¼Œå› æ­¤ä¸Šä¼ æ–‡ä»¶æ—¶é»˜è®¤ä½¿ç”¨çš„æ˜¯rootç”¨æˆ·ï¼Œæ­¤æ—¶éœ€è¦å…ˆæ›´æ”¹æ–‡ä»¶æ‰€æœ‰è€… ) </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exit</span><br><span class="line">chown -R steam:steam /home/steam </span><br><span class="line">su steam</span><br></pre></td></tr></table></figure><p>å†è¿›å…¥å­˜æ¡£æ–‡ä»¶å¤¹ï¼Œä¿®æ”¹æœåŠ¡å™¨tokenï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /home/steam/.klei/DoNotStarveTogether/MyDediServer</span><br><span class="line"><span class="meta">#</span> ç¼–è¾‘cluster_token.txt</span><br><span class="line">vim cluster_token.txt</span><br><span class="line"><span class="meta">#</span> æ­¤æ—¶æŒ‰iè¿›å…¥ç¼–è¾‘æ¨¡å¼ï¼Œåœ¨æ–‡ä»¶ä¸­è¾“å…¥ä¹‹å‰è·å–çš„æœåŠ¡å™¨token</span><br><span class="line">pds-g^KU_uGVY9tdU^M***************************Sdsg50g4A6jg=</span><br><span class="line"><span class="meta">#</span> ç¼–è¾‘å®Œæˆï¼ŒæŒ‰ESCï¼Œè¾“å…¥:wq å›è½¦ï¼Œå³ä¸ºä¿å­˜å¹¶é€€å‡º</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘ç®¡ç†å‘˜åˆ—è¡¨ ( éå¿…é¡» ) : </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> ç¼–è¾‘adminlist.txtç®¡ç†å‘˜åˆ—è¡¨ï¼Œè¾“å…¥ä½ æƒ³æ·»åŠ çš„ç©å®¶IDï¼ˆç±»ä¼¼äºä¹‹å‰è·å–çš„ä¸ªäººIDï¼‰ç”±äºæœåŠ¡å™¨tokenæ‰€æœ‰è€…é»˜è®¤æ‹¥æœ‰ç®¡ç†å‘˜æƒé™ï¼Œå› æ­¤ä¸éœ€è¦æ·»åŠ è‡ªå·±çš„IDï¼Œæ­¤å¤„ä»…åšä¸ºå‚è€ƒ</span><br><span class="line">vim adminlist.txt</span><br><span class="line"><span class="meta">#</span> è¾“å…¥</span><br><span class="line">KU_uG******</span><br><span class="line"><span class="meta">#</span> ç¼–è¾‘å®Œæˆï¼ŒæŒ‰ESCï¼Œè¾“å…¥:wq å›è½¦ï¼Œå³ä¸ºä¿å­˜å¹¶é€€å‡º</span><br></pre></td></tr></table></figure><p>ç¼–è¾‘é»‘åå•åˆ—è¡¨ ( éå¿…é¡» ) : </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim blocklist.txt</span><br><span class="line"><span class="meta">#</span> è¾“å…¥é»‘åå•ç©å®¶ID</span><br><span class="line">xxxxxxx</span><br><span class="line"><span class="meta">#</span> ç¼–è¾‘å®Œæˆï¼ŒæŒ‰ESCï¼Œè¾“å…¥:wq å›è½¦ï¼Œå³ä¸ºä¿å­˜å¹¶é€€å‡º</span><br></pre></td></tr></table></figure><h4 id="6-MODä¸‹è½½åŠä½¿ç”¨"><a href="#6-MODä¸‹è½½åŠä½¿ç”¨" class="headerlink" title="6.MODä¸‹è½½åŠä½¿ç”¨"></a>6.MODä¸‹è½½åŠä½¿ç”¨</h4><p>Modçš„é…ç½®æ–‡ä»¶å³ä¸ºä¸Šé¢æ‰€è¯´çš„modoverrides.luaï¼Œä½¿ç”¨ç¼–è¾‘é¡µé¢æ‰“å¼€ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">  [<span class="string">"workshop-1160616621"</span>]=&#123;</span><br><span class="line">    configuration_options=&#123; Language=<span class="string">"def"</span>, Ownership=<span class="literal">true</span>, Travel_Cost=<span class="number">32</span> &#125;,</span><br><span class="line">    enabled=<span class="literal">false</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="string">"workshop-1216718131"</span>]=&#123; configuration_options=&#123; clean=<span class="literal">true</span>, lang=<span class="literal">true</span>, stack=<span class="literal">true</span> &#125;, enabled=<span class="literal">true</span> &#125;,</span><br><span class="line">  [<span class="string">"workshop-362175979"</span>]=&#123; configuration_options=&#123; [<span class="string">"Draw over FoW"</span>]=<span class="string">"disabled"</span> &#125;, enabled=<span class="literal">true</span> &#125;,</span><br><span class="line">  [<span class="string">"workshop-378160973"</span>]=&#123;</span><br><span class="line">    configuration_options=&#123;</span><br><span class="line">     ENABLEPINGS=<span class="literal">true</span>,</span><br><span class="line">     FIREOPTIONS=<span class="number">2</span>,</span><br><span class="line">     OVERRIDEMODE=<span class="literal">false</span>,</span><br><span class="line">     SHAREMINIMAPPROGRESS=<span class="literal">true</span>,</span><br><span class="line">     SHOWFIREICONS=<span class="literal">true</span>,</span><br><span class="line">     SHOWPLAYERICONS=<span class="literal">true</span>,</span><br><span class="line">     SHOWPLAYERSOPTIONS=<span class="number">2</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    enabled=<span class="literal">true</span> </span><br><span class="line">  &#125;,</span><br><span class="line">  [<span class="string">"workshop-703758203"</span>]=&#123; configuration_options=&#123;  &#125;, enabled=<span class="literal">true</span> &#125;,</span><br><span class="line">  [<span class="string">"workshop-804317397"</span>]=&#123;</span><br><span class="line">    configuration_options=&#123;</span><br><span class="line">      buffgo=<span class="literal">false</span>,</span><br><span class="line">      fhl_cos=<span class="number">0.05</span>,</span><br><span class="line">      fhl_hjopen=<span class="literal">false</span>,</span><br><span class="line">      likeornot=<span class="literal">false</span>,</span><br><span class="line">      openli=<span class="literal">false</span>,</span><br><span class="line">      openlight=<span class="literal">false</span>,</span><br><span class="line">      zzj_cankanshu=<span class="literal">false</span>,</span><br><span class="line">      zzj_canuseashammer=<span class="literal">false</span>,</span><br><span class="line">      zzj_canuseasshovel=<span class="literal">false</span>,</span><br><span class="line">      zzj_canwakuang=<span class="literal">false</span>,</span><br><span class="line">      zzj_finiteuses=<span class="number">210</span>,</span><br><span class="line">      zzj_fireopen=<span class="literal">false</span>,</span><br><span class="line">      zzj_pre=<span class="number">1</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    enabled=<span class="literal">true</span> </span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">--  Show Me</span></span><br><span class="line">  [<span class="string">"workshop-666155465"</span>]=&#123;</span><br><span class="line">    configuration_options=&#123; food_estimation=<span class="number">-1</span>, food_order=<span class="number">0</span>, food_style=<span class="number">0</span>, lang=<span class="string">"chs"</span>, show_food_units=<span class="number">-1</span> &#125;,</span><br><span class="line">    enabled=<span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line"><span class="comment">--  å¤æ´»</span></span><br><span class="line">  [<span class="string">"workshop-462434129"</span>]=&#123;</span><br><span class="line">    configuration_options=&#123;</span><br><span class="line">      MOD_RESTART_ALLOW_KILL=<span class="literal">false</span>,</span><br><span class="line">      MOD_RESTART_ALLOW_RESTART=<span class="literal">true</span>,</span><br><span class="line">      MOD_RESTART_ALLOW_RESURRECT=<span class="literal">true</span>,</span><br><span class="line">      MOD_RESTART_CD_KILL=<span class="number">100</span>,</span><br><span class="line">      MOD_RESTART_CD_RESTART=<span class="number">100</span>,</span><br><span class="line">      MOD_RESTART_CD_RESURRECT=<span class="number">100</span>,</span><br><span class="line">      MOD_RESTART_FORCE_DROP_MODE=<span class="number">1</span>,</span><br><span class="line">      MOD_RESTART_IGNORING_ADMIN=<span class="literal">true</span>,</span><br><span class="line">      MOD_RESTART_TRIGGER_MODE=<span class="number">1</span>,</span><br><span class="line">      MOD_RESTART_WELCOME_TIPS=<span class="literal">true</span>,</span><br><span class="line">      MOD_RESTART_WELCOME_TIPS_TIME=<span class="number">6</span> </span><br><span class="line">    &#125;,</span><br><span class="line">    enabled=<span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>workshop-[id] æ­¤å¤„IDå³ä¸ºåˆ›æ„å·¥åŠä¸­è¿æ¥çš„IDï¼Œå¯ç›´æ¥åœ¨åˆ›æ„å·¥åŠä¸­æŸ¥çœ‹ï¼›configuration_optionsé…ç½®é€‰é¡¹åŒæ¸¸æˆä¸­Modé…ç½®ç›¸åŒï¼Œç”±äºä¸æ¸…æ¥šå…·ä½“é…ç½®å†…å®¹ï¼Œä¸æ¨èæ‰‹åŠ¨ä¿®æ”¹ã€‚</p><p>é‚£å¦‚ä½•ä¸‹è½½Modå‘¢ï¼Ÿé¦–å…ˆéœ€è¦ç¼–è¾‘æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim ~/dst/mods/dedicated_server_mods_setup.lua</span><br><span class="line"><span class="meta">#</span> åœ¨æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ : ( æ‹¬å·ä¸­ä¸º Mod åœ¨åˆ›æ„å·¥åŠä¸­çš„ idï¼Œå†…å®¹æŒ‰ç…§è‡ªèº«æœåŠ¡å™¨æ‰€éœ€Modå¡«å†™ ) </span><br><span class="line">ServerModSetup("1216718131")</span><br><span class="line">ServerModSetup("375850593")</span><br><span class="line">ServerModSetup("378160973")</span><br><span class="line">ServerModSetup("458587300")</span><br><span class="line">ServerModSetup("703758203")</span><br><span class="line">ServerModSetup("804317397")</span><br><span class="line">ServerModSetup("1699254645")</span><br><span class="line"><span class="meta">#</span> ä¿å­˜é€€å‡º</span><br><span class="line"><span class="meta">#</span> PS:æ­¤å¤„è¿˜å¯ä»¥ç›´æ¥è¾“å…¥Modåˆé›†ï¼Œå³ServerModCollectionSetup("[id]")</span><br></pre></td></tr></table></figure><p>é…ç½®è¿‡ä¹‹åï¼Œä¸‹æ¬¡å¯åŠ¨æ¸¸æˆæ—¶å°±ä¼šè‡ªåŠ¨ä¸‹è½½Modå¹¶å¯ç”¨ã€‚</p><h4 id="7-å¯åŠ¨æ¸¸æˆ"><a href="#7-å¯åŠ¨æ¸¸æˆ" class="headerlink" title="7.å¯åŠ¨æ¸¸æˆ"></a>7.å¯åŠ¨æ¸¸æˆ</h4><p>å¯ä»¥ç›´æ¥å¯åŠ¨ ( æ¨èä½¿ç”¨è„šæœ¬ ) : </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~/dst/bin</span><br><span class="line"><span class="meta">#</span> å¯åŠ¨åœ°é¢ä¸–ç•Œ</span><br><span class="line">./dontstarve_dedicated_server_nullrenderer -console -cluster MyDediServer -shard Master</span><br><span class="line"><span class="meta">#</span> å¯åŠ¨æ´ç©´ä¸–ç•Œ</span><br><span class="line">./dontstarve_dedicated_server_nullrenderer -console -cluster MyDediServer -shard Caves</span><br></pre></td></tr></table></figure><p>ç¼–å†™å¯åŠ¨è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/dst_script</span><br><span class="line">cd ~/dst_script</span><br><span class="line">touch dst_master.sh</span><br><span class="line">touch dst_caves.sh</span><br><span class="line">chmod a+x dst_master.sh</span><br><span class="line">chmod a+x dst_caves.sh</span><br><span class="line"><span class="meta">#</span> ç¼–è¾‘æ ‡æœ¬</span><br><span class="line"></span><br><span class="line">vim dst_master.sh</span><br><span class="line"><span class="meta">#</span> è¾“å…¥</span><br><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line">cd ~/dst/bin</span><br><span class="line">screen -dmS "dst_overworld" ./dontstarve_dedicated_server_nullrenderer -console -cluster MyDediServer -shard Master</span><br><span class="line"><span class="meta">#</span> ä¿å­˜é€€å‡º</span><br><span class="line"></span><br><span class="line">vim dst_caves.sh</span><br><span class="line"><span class="meta">#</span> è¾“å…¥</span><br><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line">cd ~/dst/bin</span><br><span class="line">screen -dmS "dst_caves" ./dontstarve_dedicated_server_nullrenderer -console -cluster MyDediServer -shard Caves</span><br><span class="line"><span class="meta">#</span> ä¿å­˜é€€å‡º</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <a href="https://www.cnblogs.com/lpfuture/p/5786843.html" target="_blank" rel="noopener">screen</a> -dmS å‘½ä»¤å¯åŠ¨è¿›ç¨‹æ—¶ï¼Œä¸ä¼šæ˜¾ç¤ºå¯¹åº”çš„æ§åˆ¶å°ã€‚å¦‚æœéœ€è¦ä½¿ç”¨æ§åˆ¶å°ï¼Œåˆ™éœ€è¦ä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> æ¢å¤åˆ°åœ°é¢ä¸–ç•Œè¿›ç¨‹</span><br><span class="line">screen -r dst_overworld</span><br><span class="line"><span class="meta">#</span> éšè—æ§åˆ¶å°æŒ‰ä¸‹Ctrl+Aç„¶åæŒ‰ä¸‹Ctrl+Då³å¯</span><br><span class="line"><span class="meta">#</span> æ¢å¤åˆ°æ´ç©´ä¸–ç•Œè¿›ç¨‹</span><br><span class="line">screen -r dst_caves</span><br><span class="line"><span class="meta">#</span> éšè—æ§åˆ¶å°æŒ‰ä¸‹Ctrl+Aç„¶åæŒ‰ä¸‹Ctrl+Då³å¯</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æ¸¸æˆï¼Œè¿è¡Œè„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./dst_master.sh</span><br><span class="line">./dst_caves.sh</span><br></pre></td></tr></table></figure><p>ç­‰æœåŠ¡å™¨å¯åŠ¨åï¼Œå³å¯åœ¨å¤§å…æœç´¢åˆ°å¯¹åº”æœåŠ¡å™¨ã€‚</p><h4 id="8-å…³äºæ›´æ–°"><a href="#8-å…³äºæ›´æ–°" class="headerlink" title="8.å…³äºæ›´æ–°"></a>8.å…³äºæ›´æ–°</h4><p>ç¼–å†™æ›´æ–°è„šæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch ~/dst_script/update.sh</span><br><span class="line">chmod a+x ~/dst_script/update.sh</span><br><span class="line">vim ~/dst_script/update.sh</span><br></pre></td></tr></table></figure><p>è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>æ›´æ–°æ¸¸æˆ</span><br><span class="line">~/steamcmd/steamcmd.sh +login anonymous +force_install_dir /home/steam/dst +app_update 343050 validate +quit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>æ›´æ–°mod</span><br><span class="line">cd /home/steam/dst/bin</span><br><span class="line">~/dst/bin/dontstarve_dedicated_server_nullrenderer -only_update_server_mods</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œæ—¶éœ€è¦å…³é—­æœåŠ¡å™¨ã€‚</p><p>é¥¥è’çš„æ¸¸æˆå­˜æ¡£ä½ç½®é»˜è®¤ä¸º ~/.kiel/DoNotStarveTogether/ä¸­ï¼Œä¸Šé¢æˆ‘ä»¬å¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®šäº†-clusterçš„å‚æ•°ï¼Œæ¸¸æˆå°±ä¼šå†ä¸Šè¿°æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºMyDediServerçš„æ–‡ä»¶å¤¹ï¼Œè‹¥ä¸æŒ‡å®šè¯¥å‚æ•°ï¼Œé»˜è®¤åˆ›å»ºCluster_1ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æ¸¸æˆæœåŠ¡å™¨ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
            <tag> é¥¥è’ </tag>
            
            <tag> ä¸“ç”¨æœåŠ¡å™¨ </tag>
            
            <tag> Shell </tag>
            
            <tag> é˜¿é‡Œäº‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”ŸæˆExcelå’ŒCSVçš„å·¥å…·ç±»</title>
      <link href="/2019/01/21/%E7%94%9F%E6%88%90Excel%E5%92%8CCSV%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB/"/>
      <url>/2019/01/21/%E7%94%9F%E6%88%90Excel%E5%92%8CCSV%E7%9A%84%E5%B7%A5%E5%85%B7%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨Javaç¼–å†™çš„ç”ŸæˆExcelå’ŒCSVçš„å·¥å…·ç±»ã€‚</p><a id="more"></a><p>ç”±äºæ•°æ®é‡è¿‡å¤§æ—¶ï¼Œç”ŸæˆExcelé€Ÿåº¦å¾ˆæ…¢ï¼Œè¿‡ç¨‹ä¸­å†…å­˜å ç”¨é‡å¾ˆå¤§ã€‚å› æ­¤å½“æ•°æ®æ¡æ•°å¤§äº10000æ—¶ï¼Œä¸æ”¯æŒç”ŸæˆExcelæ–‡ä»¶ï¼Œå¹¶ä¸”ä½¿ç”¨CopyManagerï¼ˆpostgresqlä¸­çš„å·¥å…·ï¼‰æ¥ç”ŸæˆCSVæ–‡ä»¶ã€‚</p><p>åˆ©ç”¨æŸ¥è¯¢åçš„ç»“æœç”ŸæˆExcelå’ŒCSVæ–‡ä»¶çš„ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.unicom.simpledemo.dao.UserDefinedSQLMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.CellStyle;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.ss.usermodel.HorizontalAlignment;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.streaming.SXSSFCell;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.streaming.SXSSFRow;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.streaming.SXSSFSheet;</span><br><span class="line"><span class="keyword">import</span> org.apache.poi.xssf.streaming.SXSSFWorkbook;</span><br><span class="line"><span class="keyword">import</span> org.postgresql.copy.CopyManager;</span><br><span class="line"><span class="keyword">import</span> org.postgresql.core.BaseConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Value;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpSession;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Author by BayMin, Date on 2018/11/15.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExportUtils</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driverClass;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String dbUrl;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String dbUserName;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String dbPassword;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.driver-class-name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDriverClass</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        driverClass = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.url&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDbUrl</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        dbUrl = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.username&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDbUserName</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        dbUserName = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value</span>(<span class="string">"$&#123;spring.datasource.druid.password&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDbPassword</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">        dbPassword = str;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ ¹æ®æŸ¥è¯¢ç»“æœç”ŸæˆExcel</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> ç”Ÿæˆçš„Excel</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> SXSSFWorkbook <span class="title">mapListToExcel</span><span class="params">(HttpSession session, UserDefinedSQLMapper userDefinedSQLMapper)</span> </span>&#123;</span><br><span class="line">        List&lt;LinkedHashMap&lt;String, Object&gt;&gt; linkedHashMaps = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">int</span> rows = (<span class="keyword">int</span>) session.getAttribute(<span class="string">"rows"</span>);</span><br><span class="line">        <span class="keyword">if</span> (rows &gt;= <span class="number">10000</span>) &#123;</span><br><span class="line">            log.error(<span class="string">"è¡Œæ•°ä¸º"</span> + rows + <span class="string">"ï¼Œä¸å°äº10000è¡Œï¼Œæ— æ³•å¯¼å‡ºä¸ºExcelè¡¨æ ¼ï¼"</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        linkedHashMaps = (List&lt;LinkedHashMap&lt;String, Object&gt;&gt;) session.getAttribute(<span class="string">"linkedHashMaps"</span>);</span><br><span class="line">        log.info(<span class="string">"æ­£åœ¨ç”ŸæˆExcelè¡¨æ ¼..."</span>);</span><br><span class="line">        SXSSFWorkbook workbook = <span class="keyword">new</span> SXSSFWorkbook(<span class="number">100</span>);</span><br><span class="line">        SXSSFSheet sheet = workbook.createSheet(<span class="string">"result"</span>);</span><br><span class="line">        SXSSFRow row = sheet.createRow(<span class="number">0</span>);</span><br><span class="line">        CellStyle style = workbook.createCellStyle();</span><br><span class="line">        style.setAlignment(HorizontalAlignment.CENTER);</span><br><span class="line">        LinkedList&lt;String&gt; keys = (LinkedList&lt;String&gt;) session.getAttribute(<span class="string">"keys"</span>);</span><br><span class="line">        <span class="keyword">int</span> columnNum = keys.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; columnNum; i++) &#123;</span><br><span class="line">            SXSSFCell cell = row.createCell(i);</span><br><span class="line">            cell.setCellValue(keys.get(i));</span><br><span class="line">            cell.setCellStyle(style);</span><br><span class="line">            sheet.trackAllColumnsForAutoSizing();</span><br><span class="line">            sheet.autoSizeColumn(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; linkedHashMaps.size(); i++) &#123;</span><br><span class="line">            row = sheet.createRow(i + <span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span> (linkedHashMaps.get(i) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                Iterator&lt;Map.Entry&lt;String, Object&gt;&gt; iterator = linkedHashMaps.get(i).entrySet().iterator();</span><br><span class="line">                <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">                    Map.Entry&lt;String, Object&gt; next = iterator.next();</span><br><span class="line">                    <span class="keyword">if</span> (next.getValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        row.createCell(j++).setCellValue(next.getValue().toString());</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        row.createCell(j++).setCellValue(<span class="string">""</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                row.createCell(<span class="number">0</span>).setCellValue(<span class="string">""</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.info(<span class="string">"ç”ŸæˆExcelè¡¨æ ¼å®Œæˆï¼"</span>);</span><br><span class="line">        <span class="keyword">return</span> workbook;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å‡ºExcel</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> workbook éœ€è¦å¯¼å‡ºçš„Excel</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exportExcel</span><span class="params">(HttpServletRequest request, HttpServletResponse response, SXSSFWorkbook workbook)</span> </span>&#123;</span><br><span class="line">        response.setContentType(<span class="string">"application/vnd.ms-excel"</span>);</span><br><span class="line">        response.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment;filename=Table-"</span> + Utils.parseDate(<span class="keyword">new</span> Date()) + <span class="string">".xlsx"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            OutputStream outputStream = response.getOutputStream();</span><br><span class="line">            workbook.write(outputStream);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å¯¼å‡ºCSVæ–‡ä»¶</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> session session(å…¶ä¸­åŒ…å«sql)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exportCSV</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HttpSession session)</span> </span>&#123;</span><br><span class="line">        LinkedList&lt;String&gt; keys = (LinkedList&lt;String&gt;) session.getAttribute(<span class="string">"keys"</span>);</span><br><span class="line">        StringBuilder tableHead = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        <span class="keyword">for</span> (String str : keys) &#123;</span><br><span class="line">            tableHead.append(str).append(<span class="string">","</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        String headString = tableHead.substring(<span class="number">0</span>, tableHead.length() - <span class="number">1</span>);</span><br><span class="line">        headString = headString.concat(<span class="string">"\n"</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            response.setContentType(<span class="string">"text/csv"</span>);</span><br><span class="line">            response.setHeader(<span class="string">"Content-disposition"</span>, <span class="string">"attachment;filename=Table-"</span> + Utils.parseDate(<span class="keyword">new</span> Date()) + <span class="string">".csv"</span>);</span><br><span class="line">            OutputStream outputStream = response.getOutputStream();</span><br><span class="line">            <span class="keyword">if</span> ((<span class="keyword">int</span>) session.getAttribute(<span class="string">"rows"</span>) &gt;= <span class="number">10000</span>) &#123;</span><br><span class="line">                exportCSVBySQL(request, response, session, headString, outputStream);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                exportCSVBySession(request, response, session, headString, outputStream);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exportCSVBySession</span><span class="params">(HttpServletRequest request, HttpServletResponse</span></span></span><br><span class="line"><span class="function"><span class="params">            response, HttpSession session, String headString, OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder(headString);</span><br><span class="line">        String csv = <span class="string">""</span>;</span><br><span class="line">        List&lt;LinkedHashMap&lt;String, Object&gt;&gt; linkedHashMapsTop500 = (List&lt;LinkedHashMap&lt;String, Object&gt;&gt;) session.getAttribute(<span class="string">"linkedHashMaps"</span>);</span><br><span class="line">        <span class="keyword">for</span> (LinkedHashMap&lt;String, Object&gt; linkedHashMap : linkedHashMapsTop500) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Object&gt; next : linkedHashMap.entrySet()) &#123;</span><br><span class="line">                <span class="keyword">if</span> (next.getValue() != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    stringBuilder.append(next.getValue().toString());</span><br><span class="line">                &#125;</span><br><span class="line">                stringBuilder.append(<span class="string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            stringBuilder.deleteCharAt(stringBuilder.length() - <span class="number">1</span>).append(<span class="string">"\n"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        csv = stringBuilder.substring(<span class="number">0</span>, stringBuilder.length() - <span class="number">1</span>);</span><br><span class="line">        outputStreamWrite(csv, outputStream);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">exportCSVBySQL</span><span class="params">(HttpServletRequest request, HttpServletResponse response, HttpSession</span></span></span><br><span class="line"><span class="function"><span class="params">            session, String headString, OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        outputStreamWrite(headString, outputStream);</span><br><span class="line">        String sql = session.getAttribute(<span class="string">"sql"</span>).toString();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driverClass);</span><br><span class="line">            Connection connection = DriverManager.getConnection(dbUrl, dbUserName, dbPassword);</span><br><span class="line">            CopyManager copyManager = <span class="keyword">new</span> CopyManager((BaseConnection) connection);</span><br><span class="line">            copyManager.copyOut(<span class="string">"copy ("</span> + sql + <span class="string">") to stdout with csv"</span>, outputStream);</span><br><span class="line">            outputStream.flush();</span><br><span class="line">            outputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">"ä½¿ç”¨COPYå‘½ä»¤å¯¼å‡ºCSVæ–‡ä»¶å‡ºé”™ï¼Œå½“å‰SQLä¸ºï¼š"</span> + sql);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">outputStreamWrite</span><span class="params">(String info, OutputStream outputStream)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = info.getBytes();</span><br><span class="line">        InputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        <span class="keyword">byte</span>[] buff = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</span><br><span class="line">        <span class="keyword">int</span> len;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> ((len = inputStream.read(buff)) != -<span class="number">1</span>) &#123;</span><br><span class="line">                outputStream.write(buff, <span class="number">0</span>, len);</span><br><span class="line">                outputStream.flush();</span><br><span class="line">            &#125;</span><br><span class="line">            inputStream.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> å·¥å…·ç±» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Greenplumæ•°æ®åº“è¿ç§»</title>
      <link href="/2018/12/12/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/"/>
      <url>/2018/12/12/Greenplum%E6%95%B0%E6%8D%AE%E5%BA%93%E8%BF%81%E7%A7%BB/</url>
      
        <content type="html"><![CDATA[<p>ç”±äºä¹‹å‰çš„æ•°æ®åº“ä½¿ç”¨å¹´é™è¿‡ä¹…ï¼Œæœºå™¨æ€§èƒ½æ— æ³•æ»¡è¶³æ—¥å¸¸è®¡ç®—éœ€è¦ï¼Œå› æ­¤å…¬å¸æœ€è¿‘æ–°è´­å…¥äº†è‹¥å¹²æœåŠ¡å™¨ï¼Œå¹¶å‡†å¤‡å°†æ•°æ®è¿ç§»è‡³æ–°åº“ä¸­ã€‚åœ¨æ­£å¼è¿ç§»ä¹‹å‰ï¼Œé€šè¿‡æŸ¥é˜…ç›¸å…³èµ„æ–™ï¼Œè¿›è¡Œä¸€æ¬¡æ¨¡æ‹Ÿè¿ç§»ã€‚</p><a id="more"></a><h4 id="1-å‡†å¤‡"><a href="#1-å‡†å¤‡" class="headerlink" title="1.å‡†å¤‡"></a>1.å‡†å¤‡</h4><p>â‘  VMware Workstationè½¯ä»¶</p><p>â‘¡ CentOS 7.3 é•œåƒ ( ä¸è€æœåŠ¡å™¨ç›¸åŒ )</p><p>â‘¢ Greenplum 4.3.7.3 å®‰è£…åŒ… ( <a href="https://network.pivotal.io/products/pivotal-gpdb/" target="_blank" rel="noopener">https://network.pivotal.io/products/pivotal-gpdb/</a> )</p><h4 id="2-å®‰è£…è™šæ‹Ÿæœº"><a href="#2-å®‰è£…è™šæ‹Ÿæœº" class="headerlink" title="2.å®‰è£…è™šæ‹Ÿæœº"></a>2.å®‰è£…è™šæ‹Ÿæœº</h4><p>ä¿®æ”¹æ—¶åŒºï¼Œæœ€å°å®‰è£…ï¼š</p><p><img src="https://img.vim-cn.com/bc/2bd07b48aa9868a53351be1e2f3eadefe17a65.png" alt></p><p>æ·»åŠ rootç”¨æˆ·å¯†ç ï¼š</p><p><img src="https://img.vim-cn.com/e2/6844fd5ab076e93eb004d2405345e0ca0f37f8.png" alt></p><p>å®‰è£…å®Œæˆåï¼Œä¿®æ”¹IPåœ°å€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/netword-scripts/ifcfg-eno***</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">PEERDNS=yes</span><br><span class="line">PEERROUTES=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_PEERDNS=yes</span><br><span class="line">IPV6_PEERROUTES=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">NAME=eno16777736</span><br><span class="line">UUID=5bed79bf-0f21-40fe-a92c-63aa29d0dbdd</span><br><span class="line">DEVICE=eno16777736</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.216.128</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.216.2</span><br><span class="line">DNS1=114.114.114.114</span><br><span class="line">DNS2=8.8.8.8</span><br></pre></td></tr></table></figure><p>é‡å¯networkæœåŠ¡ï¼Œå¹¶ä½¿ç”¨pingæµ‹è¯•æ˜¯å¦å¯ä»¥è¿æ¥åˆ°å¤–ç½‘ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure><p>å®‰è£…ä¸€äº›éœ€è¦çš„å·¥å…·ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install vim net-tools ntp ed unzip</span><br></pre></td></tr></table></figure><p>è®¾ç½®å¼€æœºæ—¶é—´åŒæ­¥è„šæœ¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rc.d/init.d/timelock.sh</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>!/bin/bash</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span>Startup script for timelock</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#</span>chkconfig:345 85 15</span><br><span class="line"><span class="meta">#</span>description:timelock server</span><br><span class="line"><span class="meta">#</span>processname:timelock</span><br><span class="line">Â </span><br><span class="line"><span class="meta">#</span>Source function library.</span><br><span class="line">/usr/sbin/ntpdate -u ntp1.aliyun.com</span><br></pre></td></tr></table></figure><p>å¢åŠ è„šæœ¬çš„å¯æ‰§è¡Œæƒé™å¹¶æ·»åŠ åˆ°å¼€æœºå¯åŠ¨é¡¹ç›®ä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod a+xÂ  /etc/rc.d/init.d/autostart.sh</span><br><span class="line">cd /etc/rc.d/init.d</span><br><span class="line">chkconfig --add autostart.sh</span><br><span class="line">chkconfig autostart.sh on</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹ç³»ç»Ÿå†…æ ¸ ( Greenpluméœ€è¦ )ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc.sysctl.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">kernel.shmmax = 500000000</span><br><span class="line">kernel.shmmni = 4096</span><br><span class="line">kernel.shmall = 4000000000</span><br><span class="line">kernel.sem = 250 512000 100 2048</span><br><span class="line">kernel.sysrq = 1</span><br><span class="line">kernel.core_uses_pid = 1</span><br><span class="line">kernel.msgmnb = 65536</span><br><span class="line">kernel.msgmax = 65536</span><br><span class="line">kernel.msgmni = 2048</span><br><span class="line">net.ipv4.tcp_syncookies = 1</span><br><span class="line">net.ipv4.ip_forward = 0</span><br><span class="line">net.ipv4.conf.default.accept_source_route = 0</span><br><span class="line">net.ipv4.tcp_tw_recycle = 1</span><br><span class="line">net.ipv4.tcp_max_syn_backlog = 4096</span><br><span class="line">net.ipv4.conf.all.arp_filter = 1</span><br><span class="line">net.ipv4.ip_local_port_range = 1025 65535</span><br><span class="line">net.core.netdev_max_backlog = 10000</span><br><span class="line">net.core.rmem_max = 2097152</span><br><span class="line">net.core.wmem_max = 209715</span><br></pre></td></tr></table></figure><p>æ‰“å¼€æ–‡ä»¶é™åˆ¶ : ( åœ¨æœ€åæ·»åŠ  )</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/security/limits.conf</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* soft nofile 65536</span><br><span class="line">* hard nofile 65536</span><br><span class="line">* soft nproc 131072</span><br><span class="line">* hard nproc 131072</span><br></pre></td></tr></table></figure><p>åˆ›å»ºgpadminç”¨æˆ·å’Œç”¨æˆ·ç»„ ( æ¯å°éƒ½éœ€è¦é…ç½® ) ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g 530 gpadmin</span><br><span class="line">useradd -g 530 -u530 -m -d /home/gpadmin -s /bin/bash gpadmin</span><br><span class="line">passwd gpadmin</span><br></pre></td></tr></table></figure><p>å…³é—­é˜²ç«å¢™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service</span><br><span class="line">systemctl disable firewalld.service</span><br></pre></td></tr></table></figure><h4 id="3-æ‹·è´ä¸¤ä»½è™šæ‹Ÿæœº"><a href="#3-æ‹·è´ä¸¤ä»½è™šæ‹Ÿæœº" class="headerlink" title="3.æ‹·è´ä¸¤ä»½è™šæ‹Ÿæœº"></a>3.æ‹·è´ä¸¤ä»½è™šæ‹Ÿæœº</h4><p>åˆ†åˆ«ä¿®æ”¹IPã€hostnameï¼Œé…ç½®hosts</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">192.168.216.128 Master master</span><br><span class="line">192.168.216.129 sdw1</span><br><span class="line">192.168.216.130 sdw2</span><br><span class="line">Â </span><br><span class="line">192.168.216.138 Master_standby master_standby gp_master_standby</span><br><span class="line">192.168.216.139 sdw1_standby segment_standby segment</span><br><span class="line">192.168.216.140 sdw2_standby mirror_standby mirror</span><br></pre></td></tr></table></figure><p>é‡å¯ï¼Œå‡†å¤‡å®‰è£…æ•°æ®åº“ã€‚</p><h4 id="4-å®‰è£…æ•°æ®åº“"><a href="#4-å®‰è£…æ•°æ®åº“" class="headerlink" title="4.å®‰è£…æ•°æ®åº“"></a>4.å®‰è£…æ•°æ®åº“</h4><p>é¦–å…ˆåœ¨MasterèŠ‚ç‚¹ä¸Šæ“ä½œï¼š</p><p>â€‹    åˆ‡æ¢ç”¨æˆ·gpadminï¼Œè§£å‹ä¸‹è½½çš„æ•°æ®åº“æ–‡ä»¶å¹¶è¿è¡Œgreenplum-db-*.binå®‰è£…æ–‡ä»¶ ( å®‰è£…è¿‡ç¨‹ä¸­æ³¨æ„æ•°æ®åº“å®‰è£…ä½ç½® )</p><p><img src="https://img.vim-cn.com/3b/1912bbe9d46419b8f264ba46582b81e2c6e0c2.png" alt></p><p>åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir ./conf</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./conf/hostlist</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Master_standby</span><br><span class="line">sdw1_standby</span><br><span class="line">sdw2_standby</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./conf/set_host</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sdw1_standby</span><br><span class="line">sdw2_standby</span><br></pre></td></tr></table></figure><p>å¼•å…¥Greenplumçš„ç¯å¢ƒå˜é‡ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source ./greenplum-db-4.3.7.3/greenplum_path.sh</span><br></pre></td></tr></table></figure><p>äº¤æ¢é’¥åŒ™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpssh-exkeys -f ./conf/hostlist</span><br></pre></td></tr></table></figure><p>PSï¼š</p><p>ä¸€ä¸ªå°é—®é¢˜ <code>socket.gaierror: [Errno -2] Name or service not known</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åŸå›  hosts é‡Œæ²¡æœ‰é…ç½® hostname ä¸­çš„ IP</span><br></pre></td></tr></table></figure><p>å¼€å§‹å®‰è£…æ•°æ®åº“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpseginstall -f hostlist -u gpadmin -p 123456</span><br></pre></td></tr></table></figure><fancybox><img src="https://img.vim-cn.com/d5/7b15f39363f657e38b027309b3539c66a209d8.png" alt></fancybox><p>åœ¨ä¸åŒèŠ‚ç‚¹ä¸Šåˆ›å»ºæ•°æ®ç›®å½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>gp_master_standby:</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpmaster</span><br><span class="line"><span class="meta">#</span>sdw1_standby:</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdata1</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatap1</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatap2</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatam1</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatam2</span><br><span class="line"><span class="meta">#</span>sdw2_standby</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpmaster</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatap1</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatap2</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatam1</span><br><span class="line">mkdir -p /home/gpadmin/gpdata/gpdatam2</span><br></pre></td></tr></table></figure><p>æ£€æŸ¥ç³»ç»Ÿç¯å¢ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>é”™è¯¯æš‚ä¸”ä¸ç®¡ ( å¥½åƒå¹¶æ²¡æœ‰å½±å“ )</span><br><span class="line">gpcheck -f ./conf/hostlist -m Master_standby -s sdw2_standby</span><br></pre></td></tr></table></figure><p>ç¼–å†™åˆå§‹åŒ–æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>æ•°æ®åº“ä»£å·</span><br><span class="line">ARRAY_NAME="EMC Greenplum DW"</span><br><span class="line">MACHINE_LIST_FILE=/home/gpadmin/conf/seg_hosts</span><br><span class="line"><span class="meta">#</span>Segment çš„åç§°å‰ç¼€</span><br><span class="line">SEG_PREFIX=gpseg</span><br><span class="line"><span class="meta">#</span>primary segment èµ·å§‹ç«¯å£å·</span><br><span class="line">PORT_BASE=40000</span><br><span class="line"><span class="meta">#</span>æŒ‡å®š primary segment çš„æ•°æ®ç›®å½•</span><br><span class="line">declare -a DATA_DIRECTORY=(/home/gpadmin/gpdata/gpdatap1 /home/gpadmin/gpdata/gpdatap2)</span><br><span class="line">MASTER_HOSTNAME=gp_master_standby</span><br><span class="line">MASTER_DIRECTORY=/home/gpadmin/gpdata/gpmaster</span><br><span class="line">MASTER_DATA_DIRECTORY=/home/gpadmin/gpdata/gpmaster</span><br><span class="line">MASTER_PORT=5432</span><br><span class="line"><span class="meta">#</span>æŒ‡å®š bash çš„ç‰ˆæœ¬</span><br><span class="line">TRUSTED_SHELL=ssh</span><br><span class="line"><span class="meta">#</span>mirror segment èµ·å§‹ç«¯å£å·</span><br><span class="line">MIRROR_PORT_BASE=50000</span><br><span class="line"><span class="meta">#</span>primary segment ä¸»å¤‡åŒæ­¥çš„èµ·å§‹ç«¯å£å·</span><br><span class="line">REPLICATION_PORT_BASE=41000</span><br><span class="line"><span class="meta">#</span>mirror segment ä¸»å¤‡åŒæ­¥çš„èµ·å§‹ç«¯å£å·</span><br><span class="line">MIRROR_REPLICATION_PORT_BASE=51000</span><br><span class="line"><span class="meta">#</span>mirror segment çš„æ•°æ®ç›®å½•</span><br><span class="line">declare -a MIRROR_DATA_DIRECTORY=(/home/gpadmin/gpdata/gpdatam1 /home/gpadmin/gpdata/gpdatam2)</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–æ•°æ®åº“ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpinitsystem -c ./conf/gp_init_config -s sdw2_standby</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æ•°æ®åº“ : </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpstart -a</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œæ•°æ®åº“å®‰è£…å®Œæ¯•ï¼Œå‡†å¤‡è¿ç§»æ•°æ®ã€‚</p><h4 id="5-è¿ç§»æ•°æ®åº“"><a href="#5-è¿ç§»æ•°æ®åº“" class="headerlink" title="5.è¿ç§»æ•°æ®åº“"></a>5.è¿ç§»æ•°æ®åº“</h4><p>Greenplumæ•°æ®åº“è¿ç§»å¯ä»¥ä½¿ç”¨å®˜æ–¹è‡ªå¸¦å·¥å…·gptransferè¿›è¡Œè¿ç§»ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å‚ç…§å®˜ç½‘  ( <a href="https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html" target="_blank" rel="noopener">https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html</a>)</p><p>ä¿®æ”¹æºæ•°æ®åº“ä¸­é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /home/gpadmin/gpdata/gpmaster/gpseg-1/pg_hba.conf</span><br></pre></td></tr></table></figure><p>æ·»åŠ å¦‚ä¸‹ ( IPèŒƒå›´ä¸º192.168.216.1 - 192.168.216.254 ) ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host     all     all     192.168.216.1/24    md5</span><br></pre></td></tr></table></figure><p>åœ¨æºæ•°æ®åº“ä¸­é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_reload_conf()</span><br></pre></td></tr></table></figure><p>å‡†å¤‡æ‰“é€šç›®æ ‡æ•°æ®åº“ä¸æºæ•°æ®åº“ä¹‹é—´çš„é€šé“ï¼Œåˆ›å»ºæ˜ å°„æ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./conf/transferlist</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sdw1,192.168.216.129</span><br><span class="line">sdw2,192.168.216.130</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim ./conf/transhost</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sdw2_standby</span><br><span class="line">sdw1_standby</span><br><span class="line">master</span><br><span class="line">sdw1</span><br><span class="line">sdw2</span><br></pre></td></tr></table></figure><p>äº¤æ¢é’¥åŒ™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gpssh-exkeys -f /home/gpadmin/conf/transhost</span><br></pre></td></tr></table></figure><p>å¼€å§‹è¿ç§»æ•°æ®ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/gpadmin/greenplum-db-4.3.7.3/bin//gptransfer --source-map-file=/home/gpadmin/conf/transferlist --dest-host=192.168.216.128 --full</span><br></pre></td></tr></table></figure><fancybox><img src="https://img.vim-cn.com/0e/a93306672759c753ca0429f483430b24f8d431.png" alt></fancybox><p>è¿ç§»å®Œæ¯•ï¼š</p><fancybox><img src="https://img.vim-cn.com/cc/57fcbcb9ebcf4983d5170a979b7d212554b875.png" alt></fancybox><p>å°†æºæ•°æ®åº“ä¸­çš„é…ç½®æ–‡ä»¶postgresql.confå’Œpg_hba.confå‘é€è‡³ç›®æ ‡æ•°æ®åº“ä¸­ï¼Œé‡å¯ç›®æ ‡æ•°æ®åº“ã€‚</p><p>è‡³æ­¤æ•°æ®åº“è¿ç§»å®Œæ¯•ã€‚</p><h4 id="å‚è€ƒç½‘å€"><a href="#å‚è€ƒç½‘å€" class="headerlink" title="å‚è€ƒç½‘å€"></a>å‚è€ƒç½‘å€</h4><p>â‘  <a href="https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html" target="_blank" rel="noopener">https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html</a></p><p>â‘¡ <a href="https://www.cnblogs.com/liuyungao/p/5689588.html" target="_blank" rel="noopener">https://www.cnblogs.com/liuyungao/p/5689588.html</a></p>]]></content>
      
      
      <categories>
          
          <category> Greenplum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Greenplum </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> æ•°æ®è¿ç§» </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GreenplumæŸ¥çœ‹æ•°æ®åº“å’Œè¡¨æ‰€å ç£ç›˜å¤§å°</title>
      <link href="/2018/12/05/Greenplum%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E6%89%80%E5%8D%A0%E7%A3%81%E7%9B%98%E5%A4%A7%E5%B0%8F/"/>
      <url>/2018/12/05/Greenplum%E6%9F%A5%E7%9C%8B%E6%95%B0%E6%8D%AE%E5%BA%93%E5%92%8C%E8%A1%A8%E6%89%80%E5%8D%A0%E7%A3%81%E7%9B%98%E5%A4%A7%E5%B0%8F/</url>
      
        <content type="html"><![CDATA[<p>æŸ¥çœ‹æ•°æ®åº“æ‰€å ç£ç›˜å¤§å°çš„å‡ æ¡å‘½ä»¤ã€‚</p><a id="more"></a><p>è¡¨çš„å¤§å° : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_size_pretty(pg_relation_size(<span class="string">'gp_test'</span>));</span><br><span class="line"> pg_size_pretty </span><br><span class="line"><span class="comment">----------------</span></span><br><span class="line"> 1761 MB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><p>è¡¨å’Œç´¢å¼•çš„å¤§å° : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_size_pretty(pg_total_relation_size(<span class="string">'gp_test'</span>));</span><br><span class="line"> pg_size_pretty </span><br><span class="line"><span class="comment">----------------</span></span><br><span class="line"> 2186 MB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æŒ‡å®šæ•°æ®åº“å¤§å° : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> pg_size_pretty(pg_database_size(<span class="string">'zwcdb'</span>));</span><br><span class="line"> pg_size_pretty </span><br><span class="line"><span class="comment">----------------</span></span><br><span class="line"> 2241 MB</span><br><span class="line">(1 row)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“çš„å¤§å° : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> datname,pg_size_pretty(pg_database_size(datname)) <span class="keyword">from</span> pg_database;</span><br><span class="line">  datname  | pg_size_pretty </span><br><span class="line"><span class="comment">-----------+----------------</span></span><br><span class="line"> zwcdb     | 2241 MB</span><br><span class="line"> postgres  | 47 MB</span><br><span class="line"> template1 | 47 MB</span><br><span class="line"> template0 | 45 MB</span><br><span class="line"> gpperfmon | 67 MB</span><br><span class="line">(5 rows)</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æ•°æ®åˆ†å¸ƒæƒ…å†µå’Œç£ç›˜ç©ºé—´ : </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> gp_segment_id,<span class="keyword">count</span>(*) <span class="keyword">from</span> gp_test <span class="keyword">group</span> <span class="keyword">by</span> gp_segment_id <span class="keyword">order</span> <span class="keyword">by</span> <span class="number">1</span>;</span><br><span class="line"> gp_segment_id |  count  </span><br><span class="line"><span class="comment">---------------+---------</span></span><br><span class="line">             0 | 5000000</span><br><span class="line">             1 | 4999999</span><br><span class="line">             2 | 5000001</span><br><span class="line">             3 | 5000000</span><br><span class="line">(4 rows)</span><br><span class="line">Â </span><br><span class="line"><span class="keyword">select</span> dfhostname, dfspace,dfdevice <span class="keyword">from</span> gp_toolkit.gp_disk_free <span class="keyword">order</span> <span class="keyword">by</span> dfhostname;</span><br><span class="line"> dfhostname | dfspace  |  dfdevice  </span><br><span class="line"><span class="comment">------------+----------+------------</span></span><br><span class="line">  sdw1      | 12273372 |  /dev/sdb1</span><br><span class="line">  sdw1      | 12273372 |  /dev/sdb1</span><br><span class="line">  sdw2      | 12273404 |  /dev/sdb1</span><br><span class="line">  sdw2      | 12273404 |  /dev/sdb1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Greenplum </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Greenplum </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
