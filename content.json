{"meta":{"title":"兔子的个人小站","subtitle":null,"description":"博客,游戏","author":"BayMin","url":"https://39.97.115.194","root":"/"},"pages":[{"title":"404 Not Found","date":"2019-05-09T09:05:02.330Z","updated":"2019-05-09T09:05:02.330Z","comments":true,"path":"404.html","permalink":"https://39.97.115.194/404.html","excerpt":"","text":"404 Not Found 很抱歉，您访问的页面不存在可能是输入地址有误或该地址已被删除"},{"title":"关于小站","date":"2019-05-09T03:22:57.714Z","updated":"2019-05-09T03:22:57.714Z","comments":true,"path":"about/index.html","permalink":"https://39.97.115.194/about/index.html","excerpt":"","text":"本站开始创建于2019年5月5日。"},{"title":"朋友","date":"2019-05-10T07:49:40.999Z","updated":"2019-05-10T07:49:40.999Z","comments":true,"path":"friends/index.html","permalink":"https://39.97.115.194/friends/index.html","excerpt":"","text":"欢迎各位大佬留言互换友链，格式如下：名称： BayMin网址： https://www.baymin.online头像： https://www.baymin.online/img/avatar.png标签： Java,数据库"},{"title":"所有分类","date":"2019-05-10T07:50:10.397Z","updated":"2019-05-10T07:50:10.397Z","comments":true,"path":"categories/index.html","permalink":"https://39.97.115.194/categories/index.html","excerpt":"","text":""},{"title":"","date":"2019-05-09T08:17:02.191Z","updated":"2019-05-09T08:17:02.191Z","comments":true,"path":"mylist/index.html","permalink":"https://39.97.115.194/mylist/index.html","excerpt":"","text":""},{"title":"所有标签","date":"2019-05-09T02:45:49.156Z","updated":"2019-05-09T02:45:49.156Z","comments":true,"path":"tags/index.html","permalink":"https://39.97.115.194/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"Greenplum数据库迁移","slug":"Greenplum数据库迁移","date":"2018-12-12T00:20:00.000Z","updated":"2019-05-13T08:15:43.238Z","comments":true,"path":"2018/12/12/Greenplum数据库迁移/","link":"","permalink":"https://39.97.115.194/2018/12/12/Greenplum数据库迁移/","excerpt":"由于之前的数据库使用年限过久，机器性能无法满足日常计算需要，因此公司最近新购入了若干服务器，并准备将数据迁移至新库中。在正式迁移之前，通过查阅相关资料，进行一次模拟迁移。","text":"由于之前的数据库使用年限过久，机器性能无法满足日常计算需要，因此公司最近新购入了若干服务器，并准备将数据迁移至新库中。在正式迁移之前，通过查阅相关资料，进行一次模拟迁移。 1.准备① VMware Workstation软件 ② CentOS 7.3 镜像 ( 与老服务器相同 ) ③ Greenplum 4.3.7.3 安装包 ( https://network.pivotal.io/products/pivotal-gpdb/ ) 2.安装虚拟机修改时区，最小安装： 添加root用户密码： 安装完成后，修改IP地址： 1vi /etc/sysconfig/netword-scripts/ifcfg-eno*** 123456789101112131415161718192021TYPE=EthernetBOOTPROTO=staticDEFROUTE=yesPEERDNS=yesPEERROUTES=yesIPV4_FAILURE_FATAL=noIPV6INIT=yesIPV6_AUTOCONF=yesIPV6_DEFROUTE=yesIPV6_PEERDNS=yesIPV6_PEERROUTES=yesIPV6_FAILURE_FATAL=noNAME=eno16777736UUID=5bed79bf-0f21-40fe-a92c-63aa29d0dbddDEVICE=eno16777736ONBOOT=yesIPADDR=192.168.216.128NETMASK=255.255.255.0GATEWAY=192.168.216.2DNS1=114.114.114.114DNS2=8.8.8.8 重启network服务，并使用ping测试是否可以连接到外网： 1service network restart 安装一些需要的工具： 1yum -y install vim net-tools ntp ed unzip 设置开机时间同步脚本： 1vim /etc/rc.d/init.d/timelock.sh 12345678910#!/bin/bash##Startup script for timelock##chkconfig:345 85 15#description:timelock server#processname:timelock #Source function library./usr/sbin/ntpdate -u ntp1.aliyun.com 增加脚本的可执行权限并添加到开机启动项目中： 1234chmod a+x /etc/rc.d/init.d/autostart.shcd /etc/rc.d/init.dchkconfig --add autostart.shchkconfig autostart.sh on 修改系统内核 ( Greenplum需要 )： 1vim /etc.sysctl.conf 12345678910111213141516171819kernel.shmmax = 500000000kernel.shmmni = 4096kernel.shmall = 4000000000kernel.sem = 250 512000 100 2048kernel.sysrq = 1kernel.core_uses_pid = 1kernel.msgmnb = 65536kernel.msgmax = 65536kernel.msgmni = 2048net.ipv4.tcp_syncookies = 1net.ipv4.ip_forward = 0net.ipv4.conf.default.accept_source_route = 0net.ipv4.tcp_tw_recycle = 1net.ipv4.tcp_max_syn_backlog = 4096net.ipv4.conf.all.arp_filter = 1net.ipv4.ip_local_port_range = 1025 65535net.core.netdev_max_backlog = 10000net.core.rmem_max = 2097152net.core.wmem_max = 209715 打开文件限制 : ( 在最后添加 ) 1vim /etc/security/limits.conf 1234* soft nofile 65536* hard nofile 65536* soft nproc 131072* hard nproc 131072 创建gpadmin用户和用户组 ( 每台都需要配置 ) ： 123groupadd -g 530 gpadminuseradd -g 530 -u530 -m -d /home/gpadmin -s /bin/bash gpadminpasswd gpadmin 关闭防火墙： 12systemctl stop firewalld.servicesystemctl disable firewalld.service 3.拷贝两份虚拟机分别修改IP、hostname，配置hosts 1234567192.168.216.128 Master master192.168.216.129 sdw1192.168.216.130 sdw2 192.168.216.138 Master_standby master_standby gp_master_standby192.168.216.139 sdw1_standby segment_standby segment192.168.216.140 sdw2_standby mirror_standby mirror 重启，准备安装数据库。 4.安装数据库首先在Master节点上操作： ​ 切换用户gpadmin，解压下载的数据库文件并运行greenplum-db-*.bin安装文件 ( 安装过程中注意数据库安装位置 ) 创建配置文件： 1mkdir ./conf 1vim ./conf/hostlist 123Master_standbysdw1_standbysdw2_standby 1vim ./conf/set_host 12sdw1_standbysdw2_standby 引入Greenplum的环境变量： 1source ./greenplum-db-4.3.7.3/greenplum_path.sh 交换钥匙： 1gpssh-exkeys -f ./conf/hostlist PS： 一个小问题 socket.gaierror: [Errno -2] Name or service not known 1原因 hosts 里没有配置 hostname 中的 IP 开始安装数据库： 1gpseginstall -f hostlist -u gpadmin -p 123456 在不同节点上创建数据目录： 1234567891011121314#gp_master_standby:mkdir -p /home/gpadmin/gpdata/gpmaster#sdw1_standby:mkdir -p /home/gpadmin/gpdata/gpdata1mkdir -p /home/gpadmin/gpdata/gpdatap1mkdir -p /home/gpadmin/gpdata/gpdatap2mkdir -p /home/gpadmin/gpdata/gpdatam1mkdir -p /home/gpadmin/gpdata/gpdatam2#sdw2_standbymkdir -p /home/gpadmin/gpdata/gpmastermkdir -p /home/gpadmin/gpdata/gpdatap1mkdir -p /home/gpadmin/gpdata/gpdatap2mkdir -p /home/gpadmin/gpdata/gpdatam1mkdir -p /home/gpadmin/gpdata/gpdatam2 检查系统环境： 12#错误暂且不管 ( 好像并没有影响 )gpcheck -f ./conf/hostlist -m Master_standby -s sdw2_standby 编写初始化文件： 1234567891011121314151617181920212223#数据库代号ARRAY_NAME=\"EMC Greenplum DW\"MACHINE_LIST_FILE=/home/gpadmin/conf/seg_hosts#Segment 的名称前缀SEG_PREFIX=gpseg#primary segment 起始端口号PORT_BASE=40000#指定 primary segment 的数据目录declare -a DATA_DIRECTORY=(/home/gpadmin/gpdata/gpdatap1 /home/gpadmin/gpdata/gpdatap2)MASTER_HOSTNAME=gp_master_standbyMASTER_DIRECTORY=/home/gpadmin/gpdata/gpmasterMASTER_DATA_DIRECTORY=/home/gpadmin/gpdata/gpmasterMASTER_PORT=5432#指定 bash 的版本TRUSTED_SHELL=ssh#mirror segment 起始端口号MIRROR_PORT_BASE=50000#primary segment 主备同步的起始端口号REPLICATION_PORT_BASE=41000#mirror segment 主备同步的起始端口号MIRROR_REPLICATION_PORT_BASE=51000#mirror segment 的数据目录declare -a MIRROR_DATA_DIRECTORY=(/home/gpadmin/gpdata/gpdatam1 /home/gpadmin/gpdata/gpdatam2) 初始化数据库： 1gpinitsystem -c ./conf/gp_init_config -s sdw2_standby 启动数据库 : 1gpstart -a 至此，数据库安装完毕，准备迁移数据。 5.迁移数据库Greenplum数据库迁移可以使用官方自带工具gptransfer进行迁移，具体使用方法参照官网 ( https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html) 修改源数据库中配置文件： 1vim /home/gpadmin/gpdata/gpmaster/gpseg-1/pg_hba.conf 添加如下 ( IP范围为192.168.216.1 - 192.168.216.254 ) ： 1host all all 192.168.216.1/24 md5 在源数据库中重新加载配置文件： 1select pg_reload_conf() 准备打通目标数据库与源数据库之间的通道，创建映射文件： 1vim ./conf/transferlist 12sdw1,192.168.216.129sdw2,192.168.216.130 1vim ./conf/transhost 12345sdw2_standbysdw1_standbymastersdw1sdw2 交换钥匙： 1gpssh-exkeys -f /home/gpadmin/conf/transhost 开始迁移数据： 1/home/gpadmin/greenplum-db-4.3.7.3/bin//gptransfer --source-map-file=/home/gpadmin/conf/transferlist --dest-host=192.168.216.128 --full 迁移完毕： 将源数据库中的配置文件postgresql.conf和pg_hba.conf发送至目标数据库中，重启目标数据库。 至此数据库迁移完毕。 参考网址① https://gp-docs-cn.github.io/docs/best_practices/gptransfer.html ② https://www.cnblogs.com/liuyungao/p/5689588.html","categories":[{"name":"Greenplum","slug":"Greenplum","permalink":"https://39.97.115.194/categories/Greenplum/"}],"tags":[{"name":"Greenplum","slug":"Greenplum","permalink":"https://39.97.115.194/tags/Greenplum/"},{"name":"数据库","slug":"数据库","permalink":"https://39.97.115.194/tags/数据库/"},{"name":"数据迁移","slug":"数据迁移","permalink":"https://39.97.115.194/tags/数据迁移/"}]},{"title":"HelloWorld","slug":"HelloWorld","date":"2018-05-05T00:20:00.000Z","updated":"2019-05-09T08:17:51.088Z","comments":true,"path":"2018/05/05/HelloWorld/","link":"","permalink":"https://39.97.115.194/2018/05/05/HelloWorld/","excerpt":"摘要测试","text":"摘要测试 内容测试","categories":[{"name":"测试","slug":"测试","permalink":"https://39.97.115.194/categories/测试/"}],"tags":[{"name":"测试","slug":"测试","permalink":"https://39.97.115.194/tags/测试/"}]}]}